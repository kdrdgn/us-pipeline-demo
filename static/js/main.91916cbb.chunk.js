(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,a){e.exports=a(19)},17:function(e,t,a){},18:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(5),l=a.n(r),o=(a(17),a(3)),c=a(1),s=a(6),u=a(7),m=a(9),p=a(8),d=a(10),h=a(2),f=(a(18),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).updateGraph=function(e){var t=a.state.terminals,n=function(e){return t[e].totalCapacity/a.pipelines.filter(function(t){return t.source===e}).length},i=function(e){var t=0;if("shipper"===a.state.tab)t=a.state.operatorPipelines[e].allocations[a.state.shipper];else if("operator"===a.state.tab){var n=a.state.operatorPipelines[e].allocations;t=Object.keys(n).map(function(e){return n[e]}).reduce(function(e,t){return e+t})}return t},r=a.pipelines.map(function(e){var t=Object(c.a)({ltype:"nomination"},e,{value:0,color:"#0074D9"});t.value=function(e){var t=a.state.trades.filter(function(e){return e.counterparty.id!==a.state.shipper}),n=0;return t.forEach(function(t){t.pipeline&&t.pipeline.id===e&&(n+=parseInt(t.volume))}),n}(e.id);var r=i(e.id),l=n(e.source);return t.value>r&&(t.color="#FF4136",t.overload=t.value,t.value=r<l?r:l),t}),l=a.pipelines.map(function(e){var t=i(e.id),a=r.find(function(t){return t.id===e.id}),l=n(e.source);console.log(e.name,"alloc",t,"nom",a.value,"capacity",l),t>=a.value&&(t-=a.value);var o=Object(c.a)({ltype:"allocation"},e,{value:t,id:"".concat(e.id,"-allocation"),name:"".concat(e.name," Allocation"),color:"#FFDC00"});return l-(a.value+t)<0&&(o.overload=o.value,o.value=l-a.value,o.color="#FF851B"),o}),s=a.pipelines.map(function(e){var t=0,l="";"operator"===a.state.tab&&(l="".concat(e.name," Spare Capacity"));var o=i(e.id),s=r.find(function(t){return t.id===e.id}),u=n(e.source);return t=u-(s.value+o)<0?0:u-o,console.log("SPARE",e.name,"alloc",o,"nom",s.value,"spare",t,"capacity",u),Object(c.a)({ltype:"spare"},e,{value:t,id:"".concat(e.id,"-spare"),name:l,color:"#AAAAAA"})}),u=[].concat(Object(o.a)(s),Object(o.a)(l),Object(o.a)(r)),m={nodes:t,links:u};console.log("graphData",m),a.graphContainer.setAttribute("data-init",JSON.stringify(m)),e&&a.graphContainer.setAttribute("data-reload",(new Date).getTime())},a.updateOperatorPipelines=function(){var e=a.state.operatorPipelines;a.pipelines.forEach(function(t){var n=0;a.state.trades.forEach(function(e){e.pipeline&&e.pipeline.id===t.id&&(n+=parseInt(e.volume))}),e[t.id].nomination=n}),a.setState({operatorPipelines:e})},a.getPipeLineById=function(e){return a.pipelines.find(function(t){return t.id===e})},a.getCounterPartyById=function(e){return a.counterParties.find(function(t){return t.id===e})},a.getOperators=function(){var e=a.state.trades,t=(a.state.pipelines,[]);return e.reduce(function(e,a){var n=e.pipeline.id;return e[n]||(e[n]={id:(new Date).getTime(),pipeline:e.pipeline.id,nomination:0,allocations:{CPA:0,CPB:0,CPC:0}},t.push(e[n])),e[n].nomination+=parseInt(a.volume),e},{}),t},a.editTrade=function(e){var t=Object(c.a)({},e);t.pipeline=e.pipeline.id,t.counterparty=e.counterparty.id,console.log("Trade Edited",t),a.setState({form:t,isEditing:!0,editTrade:e})},a.deleteTrade=function(e,t){console.log("Trade Deleted",e);var n=a.state.trades.filter(function(t,a){return t.id!==e});console.log("deleted trades",n),a.setState({trades:n.slice(0),isEditing:!1},function(){a.updateOperatorPipelines(),a.updateGraph()})},a.handleTrade=function(e){console.log("Trade Submitted");var t=Object(c.a)({},a.state.form);t.pipeline=a.getPipeLineById(a.state.form.pipeline),t.counterparty=a.getCounterPartyById(a.state.form.counterparty);var n=a.state.trades;if(a.state.isEditing){var i=a.state.editTrade;n[a.state.trades.findIndex(function(e){return e.id===i.id})]=t}else t.id=(new Date).getTime(),n.push(t);a.setState(Object(c.a)({},n,{isEditing:!1,form:Object(c.a)({},a.emptyForm)}),function(){console.log(a.state),a.updateOperatorPipelines(),a.updateGraph()})},a.handleTradeFormChange=function(e){e.preventDefault();var t=e.target,n=a.state.form;n[t.name]=t.value,a.setState({form:Object(c.a)({},n)})},a.handleTerminalCapacityChange=function(e,t){e.preventDefault();var n=e.target,i=a.state.terminals;i[t].totalCapacity=n.value,a.setState({terminals:i},function(){a.updateGraph(!0)})},a.handleOperatorFormChange=function(e,t,n){e.preventDefault();var i=e.target,r=a.state.operatorPipelines;r[t].allocations[n]=parseInt(i.value),a.setState({operatorPipelines:r},function(){a.updateGraph()})},a.handleFlowDirection=function(e){var t=a.state.configs;t.toggleFlow=!t.toggleFlow,a.setState({configs:t});var n=document.querySelector(".sk-canvas");n&&n.classList.toggle("canvas-hidden")},a.handleTabSwitch=function(e){a.setState({tab:e},function(){a.updateGraph()})},a.handleConfigTabSwitch=function(e){a.setState({ctab:e})},a.handleSwitchShipper=function(e){e.preventDefault();var t=e.target;a.setState({shipper:t.value},function(){a.updateGraph()})},a.emptyForm={month:"",volume:"",pipeline:"",counterparty:""},a.counterParties=[{id:"CPA",name:"Counterparty A"},{id:"CPB",name:"Counterparty B"},{id:"CPC",name:"Counterparty C"},{id:"CPD",name:"Counterparty D"}],a.pipelines=[{id:"keystone-transcanada",name:"Keystone (TransCanada)",source:0,target:1},{id:"marketlink-transcanada",name:"MarketLink (TransCanada)",source:1,target:2},{id:"seaway-1",name:"Seaway 1",source:1,target:3},{id:"seaway-2",name:"Seaway 2",source:3,target:4},{id:"seaway-3",name:"Seaway 3",source:3,target:5}],a.state={tab:"shipper",ctab:"terminal",shipper:"CPA",isEditing:!1,trades:[],operatorPipelines:{},configs:{toggleFlow:!1},form:Object(c.a)({},a.emptyForm),terminals:[{id:0,name:"Pakota",totalCapacity:200,color:"#0074D9"},{id:1,name:"Cushing-Oklahoma",totalCapacity:200,color:"#85144b"},{id:2,name:"Netherland-TX",totalCapacity:200,color:"#39CCCC"},{id:3,name:"Enterprise-Jones-Creek",totalCapacity:200,color:"#B10DC9"},{id:4,name:"Echo",totalCapacity:200,color:"#001f3f"},{id:5,name:"Freeport-TX",totalCapacity:200,color:"#2ECC40"}]},a.pipelines.forEach(function(e){var t=Object(c.a)({},e,{nomination:0});t.allocations={},a.counterParties.forEach(function(e){t.allocations[e.id]=0}),a.state.operatorPipelines[e.id]=t}),a.handleTradeFormChange=a.handleTradeFormChange.bind(Object(h.a)(Object(h.a)(a))),a.handleOperatorFormChange=a.handleOperatorFormChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.graphContainer=document.getElementById("us-pipeline-visualisation-container"),this.updateGraph()}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("div",{className:"App-header container is-fluid"},i.a.createElement("div",{className:"columns"},i.a.createElement("div",{className:"column is-8"},i.a.createElement("div",{className:"box"},i.a.createElement("div",{className:"tabs"},i.a.createElement("ul",{className:"tabs-ops"},i.a.createElement("li",{className:"shipper"===this.state.tab?"is-active":""},i.a.createElement("a",{onClick:function(){e.handleTabSwitch("shipper")}},"Supplier")),i.a.createElement("li",{className:"operator"===this.state.tab?"is-active":""},i.a.createElement("a",{onClick:function(){e.handleTabSwitch("operator")}},"Operator")),i.a.createElement("div",{className:"shipper-selector"},i.a.createElement("span",null,"Shipper:"),i.a.createElement("div",{className:"select"},i.a.createElement("select",{name:"counterparty",value:this.state.shipper,onChange:this.handleSwitchShipper},this.counterParties.map(function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.name)})))))),"shipper"===this.state.tab&&i.a.createElement("div",{className:"tab-content-shipper"},i.a.createElement("h1",{className:"box__heading"},"Trade History"),i.a.createElement("form",null,i.a.createElement("table",{className:"table is-striped is-fullwidth"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Month"),i.a.createElement("th",null,"Volume"),i.a.createElement("th",null,"Pipeline"),i.a.createElement("th",null,"Counterparty"),i.a.createElement("th",null))),i.a.createElement("tbody",null,this.state.trades&&this.state.trades.filter(function(t){return t.counterparty.id!==e.state.shipper}).map(function(t,a){return i.a.createElement("tr",{key:t.id},i.a.createElement("td",null,t.month),i.a.createElement("td",null,t.volume),i.a.createElement("td",null,t.pipeline&&t.pipeline.name),i.a.createElement("td",null,t.counterparty&&t.counterparty.name),i.a.createElement("td",null,i.a.createElement("div",{className:"field is-grouped"},i.a.createElement("p",{className:"control"},i.a.createElement("button",{name:"edit-button",className:"button is-warning is-small",onClick:function(){e.editTrade(t)},type:"button"},"Edit")),i.a.createElement("p",{className:"control"},i.a.createElement("button",{name:"delete-button",className:"button is-danger is-small",onClick:function(){e.deleteTrade(t.id,a)},type:"button"},"Delete")))))}),i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("input",{className:"input is-fullwidth",type:"date",name:"month",value:this.state.form.month,onChange:this.handleTradeFormChange})),i.a.createElement("td",null,i.a.createElement("input",{className:"input is-fullwidth",type:"number",step:"100",name:"volume",value:this.state.form.volume,onChange:this.handleTradeFormChange})),i.a.createElement("td",null,i.a.createElement("div",{className:"select is-fullwidth"},i.a.createElement("select",{name:"pipeline",value:this.state.form.pipeline,onChange:this.handleTradeFormChange},i.a.createElement("option",null,"Select Pipeline"),this.pipelines.map(function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.name)})))),i.a.createElement("td",{colSpan:"2"},i.a.createElement("div",{className:"select is-fullwidth"},i.a.createElement("select",{name:"counterparty",value:this.state.form.counterparty,onChange:this.handleTradeFormChange},i.a.createElement("option",null,"Select Counterparty"),this.counterParties.filter(function(t){return t.id!==e.state.shipper}).map(function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.name)})))),i.a.createElement("td",null)))),i.a.createElement("button",{className:"button ".concat(this.state.isEditing?"is-warning":"is-primary"),type:"button",name:"submit-button",onClick:function(){e.handleTrade()}},this.state.isEditing?"Edit Trade":"Save Trade"))),"operator"===this.state.tab&&i.a.createElement("div",{className:"tab-content-operator"},i.a.createElement("h1",{className:"box__heading"},"Pipeline Allocation"),i.a.createElement("form",null,i.a.createElement("table",{className:"table is-striped is-fullwidth"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Pipeline"),i.a.createElement("th",null,"Nominations"),this.counterParties.map(function(e){return i.a.createElement("th",null,e.name)}))),i.a.createElement("tbody",null,Object.keys(this.state.operatorPipelines).map(function(t){var a=e.state.operatorPipelines[t];return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,a.name),i.a.createElement("td",null,a.nomination),e.counterParties.map(function(n){return i.a.createElement("td",{key:"".concat(t,"-").concat(n.id)},i.a.createElement("input",{className:"input is-fullwidth",type:"number",step:"100",name:"allocation",value:a.allocations[n.id],onChange:function(t){e.handleOperatorFormChange(t,a.id,n.id)}}))}))}))))))),i.a.createElement("div",{className:"column is-4"},i.a.createElement("div",{className:"box"},i.a.createElement("div",{className:"tabs"},i.a.createElement("ul",null,i.a.createElement("li",{className:"terminal"===this.state.ctab?"is-active":""},i.a.createElement("a",{onClick:function(){e.handleConfigTabSwitch("terminal")}},"Terminals")),i.a.createElement("li",{className:"config"===this.state.ctab?"is-active":""},i.a.createElement("a",{onClick:function(){e.handleConfigTabSwitch("config")}},"Configs")))),"terminal"===this.state.ctab&&i.a.createElement("div",null,i.a.createElement("table",{className:"table is-fullwidth"},i.a.createElement("tbody",null,this.state.terminals.map(function(t){return i.a.createElement("tr",{key:t.name},i.a.createElement("td",null,i.a.createElement("span",{className:"terminal-color",style:{backgroundColor:t.color}})," ",i.a.createElement("span",null,t.name)),i.a.createElement("td",null,i.a.createElement("input",{className:"input has-text-right",type:"number",step:"100",name:"terminal-name",value:t.totalCapacity,onChange:function(a){e.handleTerminalCapacityChange(a,t.id)}})))})))),"config"===this.state.ctab&&i.a.createElement("div",null,i.a.createElement("h1",{className:"box__heading"},"Configure Settings"),i.a.createElement("div",{className:"field is-grouped"},i.a.createElement("p",{className:"control"},i.a.createElement("button",{className:"button is-info",onClick:this.handleFlowDirection},this.state.configs.toggleFlow?"Hide":"Show"," Flow")),i.a.createElement("p",{className:"control"},i.a.createElement("button",{className:"button is-info",onClick:function(){e.updateGraph(!0)}},"Reload Graph")))))))))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(f,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.91916cbb.chunk.js.map